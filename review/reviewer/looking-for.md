# CodeReview的关注点

*翻译自：https://github.com/google/eng-practices/blob/master/review/reviewer/looking-for.md*

注意：在关注下面的几个点的时候，随时回想[CodeReview的标准](standard.md)。

## 设计

最重要的就是改动的总体设计。改动的各段代码是否有意义？改动是否与代码库契合？是否和其他部分可以良好集成？是不是添加次改动的好时机？

## 功能

改动是否是developer的意图？该意图是否对developer以及用户有益？

通常developer需要在提交CR之前做好自测，但是，作为reviewer还是需要考虑边界案例，寻找并发问题，像用户一样思考，确保不要漏掉肉眼可见的bug。

如果需要，reviewer可以验证改动。如果改动会直接影响用户的使用，例如 **UI的改动** ，这是进行验证的良好时机。对于通过阅读代码很难理解改动会如何影响用户，如果reviewer自己不方便构建验证条件，可以让developer提供demo来进行演示。

在涉及到 **并发编程** 的时候，特别需要考虑功能性，是否会因为竞态而产生死锁。这种问题通过简单的运行代码很难发现，而是需要developer和reviewer通过细致的思考来判定是否有问题被引入。这也是为什么不要在竞态、死锁的情况下使用并发模型的原因，这会让代码评审以及代码理解变得很复杂。

## 复杂度

改动是否过于复杂了？考虑从代码行、函数、类等层面考量这些问题。复杂往往意味着难于理解，也往往会在调用或改动代码的时候引入问题。

一个典型的复杂度问题是过度工程，当developer试图做一些当前并不需要的通用性设计或者添加系统当前并不需要的功能的时候，往往就会导致过度工程。reviewer需要特别警惕这种情况，应该鼓励developer解决当下的问题，而不需要去关注developer自己猜测未来的可能情况。未来的事情，以后再说，除非你已经能够确切看清未来。

## 测试

需要为改动配备合适的单元测试、集成测试以及端到端测试。一般来说，除了 [紧急情况](../emergencies.md) 之外，测试需要和产品代码一同添加进CL中。

确保CL中的测试是正确、合理、有用的。测试并不用来测试其自身，我们也基本不会去为了测试写测试，需要靠人为的方式来确保测试是有效的。

代码破损时，测试实际上会失败吗？ 如果代码在其下面更改，它们将开始产生误报吗？ 每个测试都会做出简单而有用的断言吗？ 测试是否在不同的测试方法之间适当地分开？

请记住，测试也是必须维护的代码。不要仅仅因为它们不是主二进制的一部分就接受测试中的复杂性。

## 命名

developer是否为每样东西都选择了合适的名字？好的名字是有合适的长度，可以在不致于难以阅读的条件下，完整的表达其所欲表达的东西。

## 注释

developer是否用便于理解的文字写了清晰的注视？这些注释是否都是必要的？通常注释应该解释代码片段 **为何存在，** 而不应该来说明代码具体在干什么。如果代码不足以清楚地表达其自身，那么你可能需要让代码更简单一些。有一些例外情况（例如正则表达式或者一些复杂的算法），说明代码具体在干什么的注释信息是有价值的，但是大部分的情况，注释应该体现代码自身不能说明的内容，例如决策背后的原因。

查看本CL之前的注释也是有意义的。也许有一个TODO项可以删掉了，或者发现之前写下的不支持本次改动的一些注释等。

注意注释不同于一个类、模块或者函数的文档，文档一般需要阐明一段代码的用途、如何使用这段代码以及使用这段代码时候的表现。

## 风格

谷歌针对各种主流的语言（甚至包括一些小众语言）都有编写 [风格指南](http://google.github.io/styleguide/)。请确保CL遵守这些风格指南。

如果你想改善一些不在风格指南中的风格点，记得加上“Nit”前缀，让开发者知道这只是一个改进点，而不是强制执行的内容。不要因为个人风格的喜好而阻塞CL的提交。
代码作者应该将代码风格和功能性改动区分开来，否则会使CL变得难以辨别具体的改动点，让合并和回滚变得更加复杂，甚至会引入一些其他的问题。如果想要对文件进行整体的风格改变，可以把这个当作一个独立的CL提交，然后再去做其他的改动。

## 文档

如果CL更改了用户构建、测试、交互或发布代码的方式，请检查它是否也更新了相关文档，包括READMEs、g3doc页面和任何生成的参考文档。如果CL删除或弃用代码，请考虑是否也应该删除文档。如果缺少文档，可以要求作者去完善。

## 逐行检查

查看已分配给您检查的 **每一行** 代码。 有时可以细看某些数据文件，生成的代码或大型数据结构之类的东西，但不要细看人工编写的类，函数或代码块，而是可以假设其中的内容是可以的。 显然，某些代码比其他代码更需要仔细检查-这是您必须做出的判断调用-但您至少应确保您了解所有代码在做什么。

如果对您来说太难阅读代码了，这会使审查速度变慢，那么您应该让developer知道这一点，并等待他们清晰化，然后再尝试审查。 在Google，我们聘请了出色的软件工程师，您就是其中之一。 如果您听不懂代码，其他开发人员也很可能不会。 因此，当您要求开发人员进行澄清时，您还可以帮助将来的开发人员理解此代码。

如果您理解了代码，但是您觉得没有资格做部分检查，那么请确保CL上有一位合格的检查人员，特别是在安全性、并发性、可访问性、国际化等复杂问题上。

## 上下文

在一个更广的上下文中查看CL通常会很有帮助。 通常，代码检查工具只会向您显示围绕要更改的部分的几行代码。 有时，您必须查看整个文件，以确保更改确实有意义。 例如，您可能会看到仅添加了四行，但是当您查看整个文件时，您会发现这四行位于50行方法中，现在确实需要分解为较小的方法。

在整个系统的上下文中考虑CL也是有用的。这个CL是改善了系统的代码健康状况，还是使整个系统更复杂、测试更少等等? **不要接受降低系统代码健康状况的CLs。** 大多数系统都是通过许多累积起来的小更改而变得复杂的，因此在新更改中防止小的复杂性非常重要。

## 赞其精华

如果您在CL中看到不错的东西，请告诉developer，尤其是当他们以很棒的方式处理了您的某条评论的时候。 代码审查通常只关注错误，但是同时也应该鼓励和赞赏良好实践。 在指导方面，有时候告诉developer哪里做对了比告诉他们哪里做错了更有价值。

## 总结

在做代码Review的时候，你应该确保如下事情：

+ 代码经过良好设计
+ 该功能对于代码的用户是有好处的
+ 任何UI改动都是合理的，且看上去也不错
+ 任何并发编程都是安全的
+ 代码并不比其需要的更复杂
+ 代码没有去实现一些当下并不清晰的未来的需要
+ 代码有适当的单元测试
+ 测试也是经过良好设计的
+ 开发者使用了清晰的命名方法
+ 注释清晰有用，通常来说在说明why而不是what
+ 代码有适当的说明文档
+ 代码符合风格指南

确保检查你被要求检查的 *每一行** 代码，查看其 **上下文** ，确保你在 **改善代码的健康状况** ，并 **赞扬开发人员** 做的好的地方。

下一篇：[查看CL](navigate.md)
