# CodeReview的标准

*翻译自：https://github.com/google/eng-practices/blob/master/review/reviewer/standard.md*

CR的主要目的是确保代码库总体代码健康程度随着时间推移而改善，所有相关的工具和过程都是为这个目的而设计的。

要达到这个目的，需要做一系列的权衡。

一方面，开发者需要能够在任务上取得进展。如果开发者从来不提交代码，代码库永远不会有改进；如果评审者让每个改动都难以入库，则会抑制开发者做改进。

另一方面，评审者需要保障每个改动不能让代码健康受损，这个很难，因为通常代码健康都会随着时间推移而变坏，特别是团队面临严重的时间限制的情况下。

还有，评审者需要有评审代码的所有权的责任感，需要去确保代码库的一致性、可维护性以及其他[CodeReview的关注点](looking-for.md)。

**所以，通常来说，如果一个改动在一定程度上改善了系统的整体代码健康度，即使不完美，评审者也应该批准。这是这个代码评审指南的重要原则。**

当然，也有一些限制。例如，如果CL添加了评审员不希望在其系统中使用的功能，那么即使代码设计良好，评审员也可以拒绝批准。

有一点很关键，没有所谓的完美代码，评审者不应该去追求“完美”，而应该追求“持续提升”，如果一个改动有提升，那么不应该因为其不够完美而延迟通过。

评审者可以毫无压力的留下评论，表达一些可能更好的东西，如果不是特别重要可以加上“建议：”让代码作者知道是可以先忽略掉的一些优化点。

注意：本文档中的任何内容都不支持通过使代码健康受损的改动，除非是[紧急情况](../emergencies.md)。

## 指导性

代码评审的指导性，是指可以通过代码评审来教会开发者一些新的东西。随着时间推移，共享知识是提高代码健康度的一部分。但是如果只是纯粹的一些教育性的东西，则需要以“建议：”或者其他方式告诉开发者可以不必在本次改动中解决。

## 原则

+ 技术事实和数据高于意见和偏好。
+ 关于风格，以风格指南为准，风格指南里面没听到的可以认为是个人偏好，如果没有风格指南，则接受个人偏好。
+ **软件设计的方方面面从来不是纯粹的风格问题或者个人偏好的问题。** 这些是以基本原则为基础，而不是个人意见。如果开发者能够用数据或者坚实的工程原理论证多种方法同样有效，审查者应该接受作者的个人偏好，否则需要以软件设计的标准原则为准。
+ 如果没有相关的适用原则，则审查者可以要求作者与当前代码库中的内容保持一致，只要不会使代码健康度恶化。

## 解决冲突

冲突在所难免，需要让审查者和开发者达成一致；如果要达成一致比较困难，考虑当面交谈或者电话会议，而不要继续使用代码评论的方式，甚至可以考虑上升层次，例如扩大审阅范围，拉上领导等，最后记得把结论同步到评论里面去，方便后来者查阅。**不要因为不能达成一致而搁置改动纳入。**

下一篇：[CodeReview的关注点](looking-for.md)
