# 代码审查的速度 

*翻译自：https://github.com/google/eng-practices/blob/master/review/reviewer/speed.md*

## 为什么CR需要快速完成？

在Google，我们 **旨在优化一组开发人员团队协作生产产品的速度** ，而不是单个开发人员编写代码的速度。 个人发展的速度固然很重要，但整个团队协作的速度更重要。

当CR的速度变慢，会有如下影响：
+ **团队整体的速度降低**。虽然，一个人不及时响应CR，他可以用这些时间去处理其他的事情，个人效率看上去是提升了。但是，因为每个变更都需要等待审查甚至重新审查，会导致团队其他成员的新特性或bug修复延迟几天、几周甚至上月。
+ **开发人员开始抵触代码审查过程**。如果reviewer总是每隔几天才回复一次，但每次都要求对改动做重大修改，这会让developer心烦意乱，很难去做修改。通常，这个时候developer会觉得reviewer过于严格。当时如果reviewer每次及时在developer进行更新时给出快速响应，即使reviewer要求对改动做出重大修改（前提是确实改善代码健康度），developer也并不会抱怨。对代码评审过程的大多数抱怨实际上是可以通过加快过程来解决的。
+ **代码健康度会受到影响**。当评审缓慢时，其实就是审查缺位了，这会让developer提交的代码可能不够好。缓慢的评审还会阻碍代码清理、重构和对现有CLs的进一步改进。

## 那么CR应该要多快呢？

如果你当前不是正在处理一个需要集中精力去处理的任务，那么应该在 **CR产生后不久** 就着手审查。

**最长不要超过一个工作日**，如果跨天，应该将CR当作第二天的头等大事来做。

遵循本指引意味着一个典型的CL应该在一天之内做完多轮（如果需要的话）评审。

## 速度 VS 中断

有一种情况，个人速度是要优先于团队速度的。就是 **当你正在处理一个需要高度集中的任务时，不要为了要做CR而打断自己**。研究显示developer在打断之后需要用相当长一段时间才能恢复到原来的开发流程中来。这时候，让CR的作者多等一会儿，对团队来说更有益。

你可以在产生断点的时候来给CR做出回应。这个断点可能是编码工作完成了，吃完饭后，刚开完会，茶水间回来等等。

## 快速回应

当我们讨论代码评审的速度时，我们关心的是响应时间，而不是CL完成整个评审并提交所需的时间。理想情况下，整个过程也应该是快速的，但 **个人快速响应比整个过程快速完成更重要**。

即使有时需要很长时间才能完成整个评审过程，在整个过程中得到评审员的快速响应可以极大地减轻开发人员对“缓慢”的代码评审感到的挫败感。

如果你当前太忙而没有时间来针对CL做完整的审阅，你依然可以给出快速回应，可以是告诉开发者你什么时候可以来做审阅，或者建议添加其他当前可以更快给出回音过的审阅者，或者是先给出一些初始的[宽泛评论](navigate.md)。当然，这并不要求你要中断自己来给出这些响应，在你的工作中断的时候就可以了。

审阅者确信代码是符合标准然后给出“LGTM”的过程是需要耗费足够的时间的，这些时间开销很重要，但是最好还是要尽快给出回应。

## 跨时区审阅

跨时区审阅的时候，尽量尝试在作者还在办公室的时候联系他。如果他已经回家了，尽量确保在他第二天上班之前完成审阅。

## 带评论通过

为了加快代码审查的速度，在某些情况下，即使reviewer在CL上留下了的评论并没有全部得到处理，也应该给予批准：
+ 审查者确信开发人员将适当地处理所有剩余评论
+ 剩下的评论涉及的改动比较小，并不需要开发者非得现在解决不可

除非另有明确说明，否则审阅者应说明是因为上面两种情况的哪一种而批准的。

当developer和reviewer在不同的时区时，带有评论的LGTM尤其值得考虑，否则开发者可能要等一整天才能得到“LGTM/批准”。

## 大型变更

如果你收到一个大型变更的审阅需求，而你没有时间，这个时候你应该要求developer把大型变更拆分成几个[小的变更](../developer/small-cls.md)，而不是直接着手审阅这个大的变更。一般来说拆分是可以做到的，而且这对于reviwer来说很有帮助，尽管会给developer增加一些额外的工作量。

如果一个CL不能分解成更小的CL，并且您没有时间快速地审阅整个改动，那么至少要对改动的总体设计写一些评论，让开发人员做些改进。作为审查人员，您的目标之一应该是始终不去阻塞developer，而应该让他们在不牺牲代码健康度的条件下可以快速做进一步的工作。

## 审阅速度越来越快

如果您遵循这些准则，并且严格执行代码审查，则应该发现整个代码审查过程会随着时间的推移而越来越快。developer会了解健康代码的要求，并从一开始就向您发送出色的CL，所需的审查时间越来越少。reveiwer学会快速做出响应，而不会在审阅过程中增加不必要的延迟。 但是，不要为了提高速度而在代码审查标准或质量上做出让步——从长远来看，这实际上并不能起到加速作用。

## 紧急情况

在一些[紧急情况下](../emergencies.md)，可以放松质量的要求而让改动快速通过审阅。不过，在做这种通过的时候，请先阅读关于“紧急情况”的说明，明确哪些确实是“紧急情况”，哪些不是。

下一篇：[如何写CR评论](comments.md)
